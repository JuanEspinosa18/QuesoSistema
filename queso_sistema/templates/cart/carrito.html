{% extends 'cart/dashBaseCliente.html' %}

{% block main %}

<div class="content px-5">
    <!-- Tabla -->
    <div class="card mb-4 card-table mt-4">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>  
                    Carrito de Pedidos
                </div>
            </div>
        </div>
        <div class="card card-custom">
            <div class="table-responsive">  
                <table id="datatablesSimple">
                    <thead>
                        <tr>
                            <th scope="col">Nombre</th>
                            <th scope="col">Cantidad</th>
                            <th scope="col">Acumulado</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if request.session.carrito %}
                            {% for key, value in request.session.carrito.items %}
                                <tr>
                                    <td>{{ value.nombre }}</td>
                                    <td>{{ value.cantidad }}</td>
                                    <td>
                                        ${{ value.acumulado }}
                                        <div class="d-inline-block ms-3">
                                            <a href="{% url 'Add' value.producto_id %}" class="badge btn btn-primary btn-custom btn-add">+</a>
                                            <a href="{% url 'Sub' value.producto_id %}" class="badge btn btn-danger btn-custom btn-sub">-</a>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="3">
                                    <div class="alert alert-danger text-center carrito-alert">Sin Productos</div>
                                </td>
                            </tr>
                        {% endif %}
                        <tr>
                            <th>Total:</th>
                            <td>${{ total_carrito }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="row text-center">
            <div class="col-6">
                <a id="btn-limpiar" href="{% url 'CLS' %}" class="btn btn-danger btn-clean mb-3">Limpiar</a>
            </div>
            <div class="col-6">
                <a href="{% url 'procesar_pedido' %}" class="btn btn-success btn-checkout mb-3">Realizar Pedido</a>
            </div>
        </div>
    </div>
</div>

<!-- Incluir SweetAlert2 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

<style>
    .swal2-confirm.custom-button {
        background-color: #01563F; 
        border-color: #01563F;
    }
    .swal2-confirm.custom-button:hover {
        background-color: #01563F; 
        border-color: #01563F;
    }
    .swal2-cancel.custom-button {
        background-color: #dc3545; /* Rojo para el botón de cancelar */
        border-color: #dc3545;
    }
    .swal2-cancel.custom-button:hover {
        background-color: #c82333; /* Color más oscuro al pasar el ratón */
        border-color: #c82333;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Mostrar alertas de SweetAlert2 para los mensajes del servidor
        {% if messages %}
            {% for message in messages %}
                Swal.fire({
                    title: '{{ message|escapejs }}',
                    icon: '{% if message.tags == "success" %}success{% elif message.tags == "warning" %}warning{% elif message.tags == "error" %}error{% else %}info{% endif %}',
                    confirmButtonText: 'Aceptar',
                    customClass: {
                        confirmButton: 'custom-button'
                    }
                }).then(() => {
                });
            {% endfor %}
        {% endif %}

        // Confirmación para limpiar el carrito
        const btnLimpiar = document.getElementById('btn-limpiar');
        if (btnLimpiar) {
            btnLimpiar.addEventListener('click', function(event) {
                event.preventDefault(); // Evita la redirección inmediata
                Swal.fire({
                    title: '¿Estás seguro?',
                    text: "Esto eliminará todos los productos del carrito.",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Sí, limpiar',
                    cancelButtonText: 'No, cancelar',
                    customClass: {
                        confirmButton: 'custom-button',
                        cancelButton: 'custom-button'
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Redirige al URL del botón si el usuario confirma
                        window.location.href = btnLimpiar.href;
                    }
                });
            });
        }
    });
</script>

{% endblock %}
